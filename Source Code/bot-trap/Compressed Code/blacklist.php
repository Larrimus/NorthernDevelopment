<?php require_once "Mobile_Detect.php";$mobileDetect=new Mobile_Detect;$isMobile=0;if($mobileDetect->isTablet()){$isMobile^=1;$isMobile<<=1;}if($mobileDetect->isMobile()){$isMobile^=1;}$badbot=0;$useragent=$_SERVER['HTTP_USER_AGENT'];$proxy_headers=array('HTTP_VIA','HTTP_X_FORWARDED_FOR','HTTP_FORWARDED_FOR','HTTP_X_FORWARDED','HTTP_FORWARDED','HTTP_CLIENT_IP','HTTP_FORWARDED_FOR_IP','VIA','X_FORWARDED_FOR','FORWARDED_FOR','X_FORWARDED','FORWARDED','CLIENT_IP','FORWARDED_FOR_IP','HTTP_PROXY_CONNECTION');$filename="blacklist.txt";$fp=fopen($filename,'r')or die("Error opening file ... <br>\n");while(!feof($fp)){$line=fgets($fp,255);$u=explode(" ",$line);$u0=$u[0];if($u0==$_SERVER['REMOTE_ADDR']){$badbot++;fseek($fp,0,SEEK_END);}}fclose($fp);$filename="IPlog";$fp=fopen($filename,'r');if($fp){$fileOutName="IPlogOut";$fileOut=fopen($fileOutName,'w')or die("Error opening file ".$fileOutName." <br>\n");$line=fgets($fp,255);$splitLine=explode(" ",$line);while(!feof($fp)&&$splitLine[0]!=$_SERVER['REMOTE_ADDR']){fwrite($fileOut,$line."\n");$line=fgets($fp,255);$splitLine=explode(" ",$line);}}else $fileOut=fopen($filename,'w')or die("Error opening file ".$filename." <br>\n");if($splitLine[0]==$_SERVER['REMOTE_ADDR']){$splitLine1=(int)$splitLine[1];if($splitLine1>=0)$splitLine1++;else $splitLine1--;fwrite($fileOut,$splitLine[0]." ".(string)$splitLine1);}else{if($badbot>0)fwrite($fileOut,$_SERVER['REMOTE_ADDR']." -1");else fwrite($fileOut,$_SERVER['REMOTE_ADDR']." 1");}if($badbot>0){header('Location: bot-trap/banned.php');}elseif($_COOKIE['notabot']=='true'||$isMobile){}elseif(in_array($_SERVER['REMOTE_PORT'],array(8080,80,6588,8000,3128,553,554))){header('Location: blocked.php?for=proxy&badremoteport='.$_SERVER['REMOTE_PORT'].'&page='.$_SERVER['PHP_SELF']);}else{foreach($proxy_headers as $x){if(isset($_SERVER[$x])){fwrite($fileOut," ".$_SERVER[$x]);}}}fwrite($fileOut," ".$_SERVER['REMOTE_PORT']);if(isset($fp)){while(!feof($fp))fwrite($fileOut,"\n".fgets($fp,255));fclose($fp);unlink($filename);rename($fileOutName,$filename);}fclose($fileOut);?>